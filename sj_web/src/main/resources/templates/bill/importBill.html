<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" th:href="@{/layui/css/layui.css}">
		<style>
			form {
				margin: 20px 20px 20px -20px;
			}
		</style>
	</head>

	<body>
		<form id="form1" class="layui-form" action="" onsubmit="return false">

			<div class="layui-form-item">
				<label class="layui-form-label">小 区 ：</label>
				<div class="layui-input-inline">
					<select id="community" lay-verify="required" lay-search="">
						<option value="">直接选择或搜索选择</option>

					</select>
				</div>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">类 型 ：</label>
				<div class="layui-input-inline">
					<select lay-verify="required" lay-search="">
						<option value="1">房屋</option>
						<option value="2">车位</option>
					</select>
				</div>
			</div>

			<div class="layui-form-item">
				<div class="layui-input-block">
					<button type="button" id="load" class="layui-btn layui-btn-normal">选择文件开始上传</button>
				</div>
			</div>
		</form>
		<script th:src="@{/js/jquery-3.2.1.js}"></script>
		<script th:src="@{/layui/layui.all.js}"></script>
		<script>
            //选择小区
            $.ajax({
                url:'../Community/getCommunityIdAndName',
                type:'post',
                dataType:'json',
                success:function(data){
                    $.each(data, function(i, val) {

                            $("#community").append(
                                "<option   value="+val.id+">"
                                + val.name + "</option>")


                    })
                    layui.form.render('select');
                }
            })


			  /*#load:为按钮,点击后生成一个隐藏的input file标签*/
        $('#load').after('<input type="file" id="load_xls" name="file" style="display:none" onchange ="uploadFile()">');
		$('#load').click(function(){
      document.getElementById("load_xls").click();

    });
       function uploadFile() {
      var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
	 parent.layer.close(index); //再执行关闭
       var uri=$("#load_xls").val();
        $.ajax({
            url: "importBill.json",
            type: "POST",
            data: {
                url:uri
            },
            contentType: false,
            processData: false,
            success: function (data) {
                  alert(11)
            },
            error:function(data){
                console.log(data)
            }
        });
    }


		</script>
	</body>

</html>