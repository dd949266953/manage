<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>通讯录</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all">
		<link rel="stylesheet" th:href="@{/css/addressBook/resident.css}" />
		<!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
	</head>

	<body>
		<div class="heads">
			<h1>通讯录</h1>
		</div>
		
		<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
			
			<ul class="layui-tab-title">
				<li class="layui-this">员工通讯录</li>
				<li>外部通讯录</li>
			</ul>
			<div class="but">
			<a class="layui-btn  add" href="addstaff.html">添加</a>
			<a class="layui-btn   del">导入</a>
			<div class="demoTable" style="margin-left: 80%; margin-top: 30px;">
				搜索ID：
				<div class="layui-inline">
					<input class="layui-input" name="id" id="demoReload" autocomplete="off">
				</div>
				<button class="layui-btn" data-type="reload">搜索</button>
			</div>
		</div>
			<div class="layui-tab-content" style="height: 100px;">
				<div class="layui-tab-item layui-show">
					<table id="demo" lay-filter="test"></table>
				</div>
				<div class="layui-tab-item" style="">
					内容二
				</div>
			</div>
		</div>

		<script th:src="@{/js/jquery-3.2.1.js}" type="text/javascript"></script>
		<script th:src="@{/layui/layui.js}" charset="utf-8"></script>
		<script th:src="@{/layui/layui.all.js}"></script>
		<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
		<script>
            layui.use('table', function() {
                var table = layui.table;
                //第一个实例
                table.render({
                    elem: "#demo",
                    url: 'getstaff',
                    page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                        layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                        //,curr: 5 //设定初始在第 5 页
                        ,
                        groups: 1 //只显示 1 个连续页码
                        ,
                        first: false //不显示首页
                        ,
                        last: false //不显示尾页
                    },
                    cols: [
                        [{
                            field: "id",
                            title: 'id'
                        },
                            {
                                field: "name",
                                title: '员工姓名'
                            },
                            {
                                field: "phone",
                                title: '员工电话'
                            },
                            {
                                field: "wxnumber",
                                title: '微信号'
                            },
                            {
                                field: "nametwo",
                                title: '昵称'
                            },
                            {
                                field: "position",
                                title: '职位'
                            },
                            {
                                field: "departmentid",
                                title: '部门编号'
                            }
                            ,
                            {
                                field: "remark",
                                title: '备注'
                            },
                            {
                                field: "right",
                                title: '编辑',
                                align: 'center',
                                toolbar: "#barDemo"
                            }
                        ]
                    ],
                    page: true
                });
                //删除
                table.on('tool(test)', function(obj) {
                    var data = obj.data; //获得当前行数据
                    console.log(data.id+1);
                    var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                    console.log(layEvent);
                    var tr = obj.tr; //获得当前行 tr 的DOM对象
                    console.log(tr);
                    if(layEvent === 'del') {
                        layer.confirm('确定要删除吗?', {
                            icon: 3,
                            title: '提示',
                            shade: '0'
                        }, function(index) {
                            $.ajax({
                                url: 'delStaff',
                                type: 'get',
                                dataType: 'json',
                                data: {
                                    id: data.id
                                },
                                success: function(data) {
                                    if(data == 1) {
                                        layer.msg('删除成功', {
                                            icon: 1
                                        });
                                        obj.del();
                                        layer.close(index);
                                    } else {
                                        layer.msg('删除失败', {
                                            icon: 2
                                        });
                                    }
                                }
                            })
                        });
                    }
                });
            });
		</script>
	<script type="text/html" id="barDemo">
					<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
					<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
				</script>
	</body>

</html>