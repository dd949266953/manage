<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>
			员工通讯录
		</title>
		<link rel="stylesheet" th:href="@{/css/back_public.css}" />
		<link th:href="@{/layui/css/layui.css}" rel="stylesheet" />
		<link rel="stylesheet" th:href="@{/css/public_list.css}" />
	</head>

	<body>
		<header>
			员工通讯录
			<!--看见了 一定要改  不改打死  别再让我提醒了-->
		</header>
		<section>
			<div class="main">
				<button class="button noborder"><i class="layui-icon btn-icon">&#xe654;</i>添加人员</button>
					<div style="float: right;" class="grabble" >
							<input  type="text" id="checkName" placeholder="请输入名称" class="search-keyword" />
							<button onclick="page()" class="noborder">
							<i class="layui-icon search">&#xe615;</i>
						</button>
							<button type="submit" class="noborder">
							<i class="layui-icon search">&#xe607;</i>
						</button>
					</div>
				<table id="demo" lay-filter="test"></table>
				<script th:src="@{/layui/layui.all.js}"></script>
				<script th:src="@{/layui/layui.js}"></script>
				<script th:src="@{/js/jquery-3.2.1.js}" type="text/javascript"></script>
				<script>
                    $(function () {
                        page();
                    })
                    //分页
                    function page() {
                        layui.use('table', function () {
                            var table = layui.table;
                            //第一个实例
                            table.render({
                                elem: "#demo",
                                loading: true,
                                url: 'getstaff.json',
                                where: {
                                    name: $("#checkName").val()
                                },
                                page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                                    //,curr: 5 //设定初始在第 5 页
                                    ,
                                    groups: 1 //只显示 1 个连续页码
                                    ,
                                    first: false //不显示首页
                                    ,
                                    last: false //不显示尾页
                                },
                                cols: [
                                    [{
                                        field: "id",
                                        title: 'id'
                                    },
                                        {
                                            field: "name",
                                            title: '员工姓名'
                                        },
                                        {
                                            field: "phone",
                                            title: '员工电话'
                                        },
                                        {
                                            field: "wxnumber",
                                            title: '微信号'
                                        },
                                        {
                                            field: "nametwo",
                                            title: '昵称'
                                        },
                                        {
                                            field: "position",
                                            title: '职位'
                                        },
                                        {
                                            field: "departmentid",
                                            title: '部门编号'
                                        }
                                        ,
                                        {
                                            field: "remark",
                                            title: '备注'
                                        },
                                        {
                                            field: "right",
                                            title: '编辑',
                                            align: 'center',
                                            toolbar: "#barDemo"
                                        }
                                    ]
                                ],
                                page: true
                            });
                            //删除
                            table.on('tool(test)', function (obj) {
                                var data = obj.data; //获得当前行数据
                                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                                var tr = obj.tr; //获得当前行 tr 的DOM对象
                                if (layEvent === 'del') {
                                    layer.confirm('确定要删除吗?', {
                                        icon: 3,
                                        title: '提示',
                                        shade: '0'
                                    }, function (index) {
                                        $.ajax({
                                            url: 'delStaff',
                                            type: 'get',
                                            dataType: 'json',
                                            data: {
                                                id: data.id
                                            },
                                            success: function (data) {
                                                if (data == 1) {
                                                    layer.msg('删除成功', {
                                                        icon: 1
                                                    });
                                                    obj.del();
                                                    layer.close(index);
                                                } else {
                                                    layer.msg('删除失败', {
                                                        icon: 2
                                                    });
                                                }
                                            }
                                        })
                                    });
                                }
                                if (layEvent == 'edit') {
                                    layer.open({
                                        type : 2,
                                        title : '修改人员信息',
                                        area : [ '700px','800px' ],
                                        content : 'updateNewEmployees.html?id=' + data.id
                                    })
                                }
                            });

                        });
                    }
                    //搜索
                    function search() {
                        page();
                    }
				</script>
				<script type="text/html" id="barDemo">
					<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
					<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
				</script>
			</div>
		</section>
		<footer>
			Copyright 2013-2018 weixiaoqu.com 成都云联峰创科技有限公司旗下产品
		</footer>
	</body>

</html>